<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JSONReader.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">client</a> &gt; <a href="index.source.html" class="el_package">edu.jsu.mcis.gamegogy</a> &gt; <span class="el_source">JSONReader.java</span></div><h1>JSONReader.java</h1><pre class="source lang-java linenums">package edu.jsu.mcis.gamegogy;

import java.io.*;
import java.net.MalformedURLException;
import java.net.URL;
import java.net.URLConnection;
import java.util.*;
import org.json.simple.*;
import org.json.simple.parser.*;

public class JSONReader implements DataReader{
	
	private String URLName;
	private List&lt;Student&gt; studentList;
	private List&lt;Course&gt; courseList;
	private BufferedReader br;
	private InputStream is;
	private URLConnection con;
	
<span class="fc" id="L20">    public JSONReader(String URL) throws MalformedURLException, IOException {</span>
<span class="fc" id="L21">		studentList = new ArrayList&lt;Student&gt;();</span>
<span class="fc" id="L22">		courseList = new ArrayList&lt;Course&gt;();</span>
		
<span class="fc bfc" id="L24" title="All 2 branches covered.">		if(URL.charAt(URL.length()-1) != '/'){</span>
<span class="fc" id="L25">			URL += &quot;/&quot;;</span>
		}
<span class="fc" id="L27">		URLName = URL;</span>
		
<span class="fc" id="L29">		buildOnlineCourse();</span>
<span class="fc" id="L30">		addOnlineCourseInfo();</span>
<span class="fc" id="L31">		buildOnlineStudent();</span>
<span class="fc" id="L32">    }</span>
	
	private void buildOnlineCourse(){
  		String myline;
    	try{
<span class="fc" id="L37">			BufferedReader in = new BufferedReader(new InputStreamReader(new ByteArrayInputStream(getCourseListCSV().getBytes())));</span>
<span class="fc" id="L38">            myline = in.readLine();</span>
<span class="fc bfc" id="L39" title="All 2 branches covered.">            while ((myline = in.readLine())!=null){</span>
<span class="fc" id="L40">				String[] course = myline.split(&quot;,&quot;);</span>
<span class="fc" id="L41">				String id = (course[0].substring(1,course[0].length()-1));</span>
<span class="fc" id="L42">				String year = (course[2].substring(1,course[2].length()-1));</span>
<span class="fc" id="L43">				String size = (course[3].substring(1,course[3].length()-1));</span>
<span class="fc" id="L44">				String term = course[1].substring(1, course[1].length()-1);</span>
<span class="fc" id="L45">				courseList.add(new Course(id, year, Integer.valueOf(size), term));		</span>
<span class="fc" id="L46">            }			</span>
        }
<span class="fc" id="L48">        catch(IOException e) {e.printStackTrace();}		</span>
<span class="fc" id="L49">    }</span>
	
	private void addOnlineCourseInfo() throws MalformedURLException, IOException{
<span class="fc bfc" id="L52" title="All 2 branches covered.">		for (String s: getCourseString()){</span>
<span class="fc" id="L53">			String courseID = s;</span>
			try{
<span class="fc" id="L55">				Course c = null;</span>
<span class="fc bfc" id="L56" title="All 2 branches covered.">				for(Course d: courseList){</span>
<span class="fc bfc" id="L57" title="All 2 branches covered.">					if(d.getId() == courseID){</span>
<span class="fc" id="L58">						c = d;</span>
					}
<span class="fc" id="L60">				}</span>
<span class="fc" id="L61">				int courseIDNum = Integer.parseInt(courseID);</span>
<span class="fc" id="L62">				String full = getDetailedCourseInfo(courseIDNum);  </span>
<span class="fc" id="L63">				BufferedReader in = new BufferedReader(new InputStreamReader(new ByteArrayInputStream(full.getBytes())));</span>
<span class="fc" id="L64">				String[] assignments = in.readLine().split(&quot;,&quot;);</span>
<span class="fc" id="L65">				List&lt;String&gt; lines = new ArrayList&lt;String&gt;();</span>
				String myline;
<span class="fc bfc" id="L67" title="All 2 branches covered.">				while ((myline = in.readLine())!=null){</span>
<span class="fc" id="L68">					lines.add(myline);</span>
				}
<span class="fc bfc" id="L70" title="All 2 branches covered.">				for (int i = 1; i &lt; assignments.length; i++){</span>
<span class="fc" id="L71">					String assignmentName = assignments[i].substring(1, assignments[i].length()-1);</span>
<span class="fc" id="L72">					Assignment a = new Assignment(assignmentName);</span>
<span class="fc bfc" id="L73" title="All 2 branches covered.">					for (int j = 0; j &lt; lines.size(); j++){</span>
<span class="fc" id="L74">						String[] row = lines.get(j).split(&quot;,&quot;);</span>
<span class="fc" id="L75">						String studentId = (row[0].substring(1,row[0].length()-1));</span>
<span class="fc" id="L76">						int score = Integer.parseInt(row[i].substring(1,row[i].length()-1));</span>
<span class="fc" id="L77">						a.addStudentAndScore(studentId, score);</span>
					}
<span class="fc" id="L79">					c.addAssignment(a);</span>
				}
<span class="fc bfc" id="L81" title="All 2 branches covered.">				for (int i = 0; i &lt; courseList.size(); i++){</span>
<span class="fc bfc" id="L82" title="All 2 branches covered.">					if (courseList.get(i).getId() == courseID){</span>
<span class="fc" id="L83">						courseList.remove(i);</span>
<span class="fc" id="L84">						courseList.add(c);</span>
					} 
				}
			}
<span class="pc" id="L88">			catch(IOException e) {e.printStackTrace();}</span>
<span class="fc" id="L89">		}</span>
<span class="fc" id="L90">	}</span>
	
	private void buildOnlineStudent(){
    	String myline;
        try{
<span class="fc" id="L95">            BufferedReader in = new BufferedReader(new InputStreamReader(new ByteArrayInputStream(getStudentListCSV().getBytes())));</span>
<span class="fc" id="L96">			String check = in.readLine();</span>
<span class="fc bfc" id="L97" title="All 2 branches covered.">            while ((myline = in.readLine())!=null){</span>
<span class="fc" id="L98">				String[] student = myline.split(&quot;,&quot;);</span>
<span class="fc" id="L99">				String id = (student[0].substring(1,student[0].length()-1));</span>
<span class="fc" id="L100">				String first = student[1].substring(1, student[1].length() - 1);</span>
<span class="fc" id="L101">				String last = student[2].substring(1, student[2].length() - 1);</span>
<span class="fc" id="L102">				String email = student[3].substring(1, student[3].length() - 1);</span>
<span class="fc" id="L103">				studentList.add(new Student(id,  first, last, email));</span>
<span class="fc" id="L104">            }</span>
        }
<span class="fc" id="L106">        catch(IOException e) {e.printStackTrace();}</span>
<span class="fc" id="L107">    }</span>
	
	private void openConnection(String URLExtension) throws MalformedURLException, IOException{
<span class="fc" id="L110">        URL url = new URL(URLName + URLExtension);</span>
<span class="fc" id="L111">        con = url.openConnection();</span>
<span class="fc" id="L112">        is = con.getInputStream();</span>
<span class="fc" id="L113">        br = new BufferedReader(new InputStreamReader(is));	</span>
<span class="fc" id="L114">	}</span>
	
    private String getStudentFromJSON(int id) throws MalformedURLException, IOException{
<span class="fc" id="L117">        String ID = String.valueOf(id);</span>
<span class="fc" id="L118">		openConnection(&quot;student/&quot; + ID);</span>
        
<span class="fc" id="L120">        String returnString = br.readLine();</span>
<span class="fc" id="L121">        String studentID = returnString.split(&quot;id\&quot;:\&quot;&quot;)[1].split(&quot;\&quot;&quot;)[0];</span>
<span class="fc" id="L122">        String studentFname = returnString.split(&quot;first\&quot;:\&quot;&quot;)[1].split(&quot;\&quot;&quot;)[0];</span>
<span class="fc" id="L123">        String studentLname = returnString.split(&quot;last\&quot;:\&quot;&quot;)[1].split(&quot;\&quot;&quot;)[0];</span>
<span class="fc" id="L124">        String studentEmail = returnString.split(&quot;email\&quot;:\&quot;&quot;)[1].split(&quot;\&quot;&quot;)[0];</span>
<span class="fc" id="L125">        returnString = &quot;\&quot;&quot; + studentID + &quot;\&quot;,\&quot;&quot; + studentFname + &quot;\&quot;,\&quot;&quot; + studentLname + &quot;\&quot;,\&quot;&quot; + studentEmail + &quot;\&quot;\n&quot;;</span>
<span class="fc" id="L126">        return returnString;</span>
    }
	
     private String getBasicCourseInfo(int id) throws MalformedURLException, IOException {

<span class="fc" id="L131">        openConnection(&quot;course/&quot; + String.valueOf(id));</span>
<span class="fc" id="L132">		StringBuffer jsonContents = new StringBuffer();</span>
		
<span class="pc" id="L134">        try(BufferedReader reader = new BufferedReader(new InputStreamReader(is))) {</span>
            String line;
<span class="fc bfc" id="L136" title="All 2 branches covered.">            while((line = reader.readLine()) != null) {</span>
<span class="fc" id="L137">                jsonContents.append(line + '\n');</span>
            }
<span class="pc bpc" id="L139" title="6 of 8 branches missed.">        }</span>
<span class="pc" id="L140">		catch(IOException i){}</span>
		
		try{
<span class="fc" id="L143">			JSONParser parser = new JSONParser();</span>
<span class="fc" id="L144">			JSONObject jobject = (JSONObject) parser.parse(jsonContents.toString());</span>
	
<span class="fc" id="L146">			Object idObject = jobject.get(&quot;id&quot;);</span>
<span class="fc" id="L147">			Object courseSize =  jobject.get(&quot;size&quot;);</span>
<span class="fc" id="L148">			Object year = jobject.get(&quot;year&quot;);</span>
<span class="fc" id="L149">			Object term = jobject.get(&quot;term&quot;);</span>
			
<span class="fc" id="L151">			return &quot;\&quot;&quot; + idObject + &quot;\&quot;,\&quot;&quot; + term + &quot;\&quot;,\&quot;&quot; + year + &quot;\&quot;,\&quot;&quot; + courseSize + &quot;\&quot;\n&quot;;</span>
		}
		
<span class="nc" id="L154">		catch(ParseException p){return &quot;&quot;;}</span>
    }
	
    private String getDetailedCourseInfo(int id) throws MalformedURLException, IOException {

<span class="fc" id="L159">        openConnection(&quot;course/&quot; + String.valueOf(id));</span>
<span class="fc" id="L160">		StringBuffer jsonContents = new StringBuffer();</span>
		
<span class="pc" id="L162">        try(BufferedReader reader = new BufferedReader(new InputStreamReader(is))) {</span>
            String line;
<span class="fc bfc" id="L164" title="All 2 branches covered.">            while((line = reader.readLine()) != null) {</span>
<span class="fc" id="L165">                jsonContents.append(line + '\n');</span>
            }
<span class="pc bpc" id="L167" title="6 of 8 branches missed.">        }</span>
<span class="pc" id="L168">		catch(IOException i){throw new IOException();}</span>

		try{
<span class="fc" id="L171">			String returnString = &quot;\&quot;ID\&quot;,&quot;;</span>
			
<span class="fc" id="L173">			JSONParser parser = new JSONParser();</span>
<span class="fc" id="L174">			JSONObject jobject = (JSONObject) parser.parse(jsonContents.toString());</span>
			
<span class="fc" id="L176">			jobject = (JSONObject) parser.parse(&quot;&quot; + jobject.get(&quot;grades&quot;));</span>
			
<span class="fc" id="L178">			String colHeadersString = &quot;&quot; + jobject.get(&quot;colHeaders&quot;);</span>
<span class="fc" id="L179">			colHeadersString = colHeadersString.substring(1,colHeadersString.length() - 1);</span>
<span class="fc" id="L180">			returnString += (colHeadersString + &quot;\n&quot;);</span>
			
<span class="fc" id="L182">			String rowHeadersString = (String) &quot;&quot; + jobject.get(&quot;rowHeaders&quot;);</span>
<span class="fc" id="L183">			String[] rowHeaders = rowHeadersString.split(&quot;,&quot;);</span>
<span class="fc" id="L184">			rowHeaders[0] = rowHeaders[0].substring(1);</span>
<span class="fc" id="L185">			rowHeaders[rowHeaders.length - 1] = rowHeaders[rowHeaders.length - 1].substring(0, rowHeaders[rowHeaders.length - 1].length() - 1);</span>
			
<span class="fc" id="L187">			Object[] dataArray = ((JSONArray) jobject.get(&quot;data&quot;)).toArray();</span>
<span class="fc" id="L188">			String s = &quot;&quot;;</span>
<span class="fc bfc" id="L189" title="All 2 branches covered.">			for (int i = 0; i &lt; dataArray.length; i++){</span>
<span class="fc" id="L190">				s += (String) &quot;&quot; + dataArray[i];</span>
			}
<span class="fc" id="L192">			String[] data = s.split(&quot;]&quot;);</span>
<span class="fc bfc" id="L193" title="All 2 branches covered.">			for (int i = 0; i &lt; data.length; i++){</span>
<span class="fc" id="L194">				data[i] = data[i].substring(1);</span>
			}
			
<span class="fc bfc" id="L197" title="All 2 branches covered.">			for (int i = 0; i &lt; data.length; i++){</span>
<span class="fc" id="L198">				String[] parts = data[i].split(&quot;,&quot;);</span>
<span class="fc" id="L199">				String newScoreLine = &quot;&quot;;</span>
<span class="fc" id="L200">				String newScore = parts[0].substring(0,parts[0].length()-2);</span>
<span class="fc" id="L201">				newScoreLine += (&quot;\&quot;&quot; + newScore + &quot;\&quot;&quot;);</span>
<span class="fc bfc" id="L202" title="All 2 branches covered.">				for (int j = 1; j &lt; parts.length; j++){</span>
<span class="fc" id="L203">					newScore = parts[j].substring(0,parts[j].length()-2);</span>
<span class="fc" id="L204">					newScoreLine += (&quot;,&quot; + &quot;\&quot;&quot; + newScore + &quot;\&quot;&quot;);</span>
				}
<span class="fc" id="L206">				data[i] = newScoreLine;</span>
			}
			
<span class="fc bfc" id="L209" title="All 2 branches covered.">			for (int i = 0; i &lt; rowHeaders.length; i++){</span>
<span class="fc" id="L210">				returnString += rowHeaders[i] + &quot;,&quot; + data[i] + &quot;\n&quot;;</span>
			}
			
<span class="fc" id="L213">			return returnString;</span>
		}
<span class="nc" id="L215">		catch(ParseException p){ return &quot;&quot;;}</span>
    }

     private List&lt;String&gt; getStudentListJSON() throws MalformedURLException, IOException{
<span class="fc" id="L219">        List&lt;String&gt; list = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L220">        String myLine = &quot;&quot;;</span>
<span class="fc" id="L221">        openConnection(&quot;studentlist&quot;);</span>

<span class="fc bfc" id="L223" title="All 2 branches covered.">        while ((myLine = br.readLine())!=null){</span>
<span class="fc" id="L224">            String[] students = myLine.split(&quot;,&quot;);</span>
<span class="fc" id="L225">			students[0] = students[0].substring(1);</span>
<span class="fc" id="L226">			students[students.length-1] = students[students.length - 1].substring(0, students[students.length-1].length()-1);</span>
<span class="fc bfc" id="L227" title="All 2 branches covered.">			for (String s: students){</span>
<span class="fc" id="L228">				list.add(s);</span>
			}
<span class="fc" id="L230">        }</span>
<span class="fc" id="L231">        return list;</span>
    }
	
     private List&lt;String&gt; getCourseListJSON() throws MalformedURLException, IOException {
<span class="fc" id="L235">        List&lt;String&gt; list = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L236">        openConnection(&quot;courselist&quot;);</span>

<span class="fc" id="L238">        String coursesLine = br.readLine();</span>
<span class="fc" id="L239">		String[] courses = coursesLine.split(&quot;,&quot;);</span>
<span class="fc" id="L240">		courses[0] = courses[0].substring(1);</span>
<span class="fc" id="L241">		courses[courses.length - 1] = courses[courses.length - 1].substring(0, courses[courses.length - 1].length() - 1);</span>
<span class="fc bfc" id="L242" title="All 2 branches covered.">		for (String s: courses){</span>
<span class="fc" id="L243">			list.add(s);</span>
		}
<span class="fc" id="L245">        return list;</span>
    }
	
	private String getStudentListCSV() throws MalformedURLException, IOException{
<span class="fc" id="L249">		String s = &quot;\&quot;ID\&quot;,\&quot;First\&quot;,\&quot;Last\&quot;,\&quot;Email\&quot;\n&quot;;</span>
<span class="fc" id="L250">		List&lt;String&gt; list = getStudentListJSON();</span>
<span class="fc bfc" id="L251" title="All 2 branches covered.">		for (int i = 0; i &lt; list.size(); i++){</span>
<span class="fc" id="L252">			String studentInfo = list.get(i).substring(1,list.get(i).length()-1);</span>
<span class="fc" id="L253">			s += getStudentFromJSON(Integer.parseInt(studentInfo));</span>
		}
<span class="fc" id="L255">		return s;</span>
	}
	
	private String getCourseListCSV() throws MalformedURLException, IOException{
<span class="fc" id="L259">		String s = &quot;\&quot;ID\&quot;,\&quot;Term\&quot;,\&quot;Year\&quot;,\&quot;Size\&quot;\n&quot;;</span>
<span class="fc" id="L260">		List&lt;String&gt; list = getCourseListJSON();</span>
<span class="fc bfc" id="L261" title="All 2 branches covered.">		for (int i = 0; i &lt; list.size(); i++){</span>
<span class="fc" id="L262">			String courseInfo = list.get(i).substring(1,list.get(i).length()-1);</span>
<span class="fc" id="L263">			s += getBasicCourseInfo(Integer.parseInt(courseInfo));</span>
		}
<span class="fc" id="L265">		return s;</span>
	}
	
	public List&lt;Student&gt; getStudentList(){
<span class="fc" id="L269">		return studentList;</span>
	}
	
	public List&lt;Course&gt; getCourseList(){
<span class="fc" id="L273">		return courseList;</span>
	}
    
	public String getURL(){
<span class="fc" id="L277">		return URLName;</span>
	}
	
	public List&lt;String&gt; getCourseString(){
<span class="fc" id="L281">		List&lt;String&gt; courseStrings = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L282" title="All 2 branches covered.">		for(Course c: courseList){</span>
<span class="fc" id="L283">			courseStrings.add(c.getId());</span>
<span class="fc" id="L284">		}</span>
<span class="fc" id="L285">		return courseStrings;</span>
	}
	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.8.201612092310</span></div></body></html>